import Head from 'next/head'
import Link from "next/link";
import {Auth, ThemeSupa} from '@supabase/auth-ui-react'
import {useSession, useUser} from '@supabase/auth-helpers-react'

import {GameList} from "../components/game_list";
import {supabase} from "../chess/supabase";

export default function Home() {
	const session = useSession()
	const user = useUser();

	// function that adds a row to the table "games" on supabase
	async function create_game() {
		let {error} = await supabase.from('games').insert([
			{
				board: [{hi: "hi"}, {lol: "hi2"}],
				created_at: new Date().toISOString(),
			}
		]);
		if (error) {
			throw error;
		}
	}

	async function update_username(username: string) {
		if (!user) {
			throw new Error("no user");
		}
		const updates = {
			id: user.id,
			username: username,
			updated_at: new Date().toISOString()
		};
		let {error} = await supabase.from('profiles').upsert(updates);
		if (error) {
			throw error;
		}
	}

	return (
		<>
			<Head>
				<title>chess test</title>
				<meta name="description" content="Generated by create next app"/>
				<meta name="viewport" content="width=device-width, initial-scale=1"/>
				<link rel="icon" href="/favicon.ico"/>
			</Head>
			<Link href="/game">view board</Link>
			<GameList/>
			<div className="container" style={{padding: '50px 0 100px 0'}}>
				{!session ? (
					<Auth supabaseClient={supabase} appearance={{theme: ThemeSupa}} providers={["google"]} theme="dark"/>
				) : (
					<>
						<button onClick={() => {
							try {
								update_username("wee" + Math.random()).then(_ => alert('Profile updated!'))
							} catch (error: any) {
								console.log("error updating profile");
								console.log(error);
							}
						}}>update username test
						</button>
						<button onClick={() => {
							create_game().then(_ => alert('Game created!'));
						}}>create game test
						</button>
						<p>signed in</p>
						<button className="button block" onClick={() => supabase.auth.signOut()}>
							Sign Out
						</button>
					</>

				)}
			</div>
			<a href={"https://github.com/Jeffmagma/chess"}>source code</a>
		</>
	)
}
